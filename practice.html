#include <SFML/Graphics.hpp>
using namespace sf;
#include <iostream>
using namespace std;

int main() {
    RenderWindow window(VideoMode(400, 500), "SFML works!", Style::Close | Style::Resize);
    window.setPosition(sf::Vector2i(300, 200));
    RectangleShape rectangle(Vector2f(100, 100));
    rectangle.setFillColor(Color::Red);

    const float moveSpeed = 5.0f;

    while(window.isOpen()) {
        Event OK;
        while(window.pollEvent(OK)) {
            if(OK.type == Event::Closed)
                window.close();
        }

        // Movement logic
        if (Keyboard::isKeyPressed(Keyboard::Key::A))
            rectangle.move(-moveSpeed, 0);
        if (Keyboard::isKeyPressed(Keyboard::Key::D))
            rectangle.move(moveSpeed, 0);
        if (Keyboard::isKeyPressed(Keyboard::Key::W))
            rectangle.move(0, -moveSpeed);
        if (Keyboard::isKeyPressed(Keyboard::Key::S))
            rectangle.move(0, moveSpeed);

        Vector2f position = rectangle.getPosition();
        float rectWidth = rectangle.getSize().x;
        float rectHeight = rectangle.getSize().y;
        float windowWidth = static_cast<float>(window.getSize().x);
        float windowHeight = static_cast<float>(window.getSize().y);

        window.clear();

        // Draw the original rectangle
        window.draw(rectangle);

        // Check and handle horizontal wrapping
        if (position.x < 0) {
            RectangleShape wrapRect(Vector2f(-position.x, rectHeight));
            wrapRect.setFillColor(rectangle.getFillColor());
            wrapRect.setPosition(windowWidth + position.x, position.y);
            window.draw(wrapRect);
        } else if (position.x + rectWidth > windowWidth) {
            RectangleShape wrapRect(Vector2f(rectWidth - (windowWidth - position.x), rectHeight));
            wrapRect.setFillColor(rectangle.getFillColor());
            wrapRect.setPosition(0, position.y);
            window.draw(wrapRect);
        }

        // Check and handle vertical wrapping
        if (position.y < 0) {
            RectangleShape wrapRect(Vector2f(rectWidth, -position.y));
            wrapRect.setFillColor(rectangle.getFillColor());
            wrapRect.setPosition(position.x, windowHeight + position.y);
            window.draw(wrapRect);
        } else if (position.y + rectHeight > windowHeight) {
            RectangleShape wrapRect(Vector2f(rectWidth, rectHeight - (windowHeight - position.y)));
            wrapRect.setFillColor(rectangle.getFillColor());
            wrapRect.setPosition(position.x, 0);
            window.draw(wrapRect);
        }

        window.display();
    }

    return 0;
}
